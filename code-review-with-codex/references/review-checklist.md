# Review Checklist

通用代码审查检查清单。每项包含检查内容、通过标准和不通过标准。

## Security (CRITICAL)

### 1. 注入攻击
- **检查**: SQL、命令、模板注入风险
- **Pass**: 所有外部输入经过参数化查询或转义处理
- **Fail**: 字符串拼接构建 SQL/命令/模板，未对用户输入做清洗

### 2. 认证与授权
- **检查**: 访问控制是否正确实施
- **Pass**: 敏感操作有权限校验，认证 token 正确验证
- **Fail**: 缺少权限检查、硬编码凭据、认证可绕过

### 3. 敏感数据
- **检查**: 密钥、凭据、PII 的处理方式
- **Pass**: 敏感数据不出现在日志/响应/代码中，使用环境变量或密钥管理
- **Fail**: 硬编码密钥、日志中打印敏感信息、响应泄露内部数据

### 4. 依赖安全
- **检查**: 新增/更新的依赖是否安全
- **Pass**: 依赖来源可信、版本固定、无已知漏洞
- **Fail**: 引入不维护的依赖、使用有已知 CVE 的版本

## Correctness (HIGH)

### 1. 逻辑正确性
- **检查**: 业务逻辑是否符合预期
- **Pass**: 逻辑清晰、条件完整、状态转换正确
- **Fail**: 条件遗漏、逻辑反转、状态不一致

### 2. 错误处理
- **检查**: 错误是否被正确捕获和处理
- **Pass**: 错误有明确处理路径，错误信息包含上下文，不吞掉错误
- **Fail**: 空 catch、忽略返回的 error、错误信息无上下文

### 3. 边界条件
- **检查**: 空值、零值、极端输入的处理
- **Pass**: nil/null/空集合/零值有明确处理，整数溢出已考虑
- **Fail**: 未检查 nil 直接解引用、数组越界、除零错误

### 4. 竞态条件
- **检查**: 并发访问共享资源的安全性
- **Pass**: 共享状态有适当同步机制，无 data race
- **Fail**: 无锁访问共享变量、check-then-act 模式无原子保证

## Performance (HIGH)

### 1. 数据库查询
- **检查**: 查询效率和 N+1 问题
- **Pass**: 批量查询替代循环查询，有适当索引，查询条件合理
- **Fail**: 循环内执行查询、全表扫描、缺少必要索引

### 2. 资源管理
- **检查**: 连接、文件句柄、内存的生命周期
- **Pass**: 资源及时释放（defer/finally/using），无泄漏风险
- **Fail**: 未关闭连接/文件、无限增长的缓存、goroutine 泄漏

### 3. 算法效率
- **检查**: 时间和空间复杂度是否合理
- **Pass**: 数据规模下复杂度可接受，无不必要的重复计算
- **Fail**: 嵌套循环处理大数据集、重复计算可缓存的结果

## Maintainability (MEDIUM)

### 1. 代码清晰度
- **检查**: 命名、结构、注释是否便于理解
- **Pass**: 命名准确表达意图，函数职责单一，复杂逻辑有注释
- **Fail**: 含义模糊的缩写、超长函数、魔法数字无解释

### 2. 抽象层次
- **检查**: 抽象是否恰当（不过度也不不足）
- **Pass**: 抽象解决了实际的重复/复杂性问题，接口设计合理
- **Fail**: 过度抽象（单一实现的接口）、该抽象未抽象（大量重复代码）

### 3. 重复代码
- **检查**: 是否存在可合理消除的重复
- **Pass**: 相似逻辑已提取为共享函数/组件
- **Fail**: 大段复制粘贴的代码、仅细微差异的重复实现

## Testing (MEDIUM)

### 1. 测试覆盖
- **检查**: 变更代码是否有对应测试
- **Pass**: 新功能有测试、bug 修复有回归测试、关键路径已覆盖
- **Fail**: 新增功能无测试、修改了逻辑但未更新测试

### 2. 测试质量
- **检查**: 测试是否有效且可维护
- **Pass**: 测试验证行为而非实现、断言明确、测试独立不互相依赖
- **Fail**: 测试仅验证不抛异常、过度 mock 导致测试无意义、测试间有隐式依赖
